<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WhisperInk.Maui.MainPage"
             Title="WhisperInk Dashboard">

    <Grid RowDefinitions="Auto, *">

        <Grid Grid.Row="0" 
              ColumnDefinitions="Auto, *" 
              RowDefinitions="Auto, Auto, Auto, Auto, Auto, Auto, Auto" 
              RowSpacing="15" 
              ColumnSpacing="15" 
              Padding="20">

            <Label Grid.Row="0" Grid.ColumnSpan="2" 
                   Text="Settings" Style="{StaticResource Headline}" FontSize="28" Margin="0,0,0,5" />

            <Label Grid.Row="1" Grid.Column="0" 
                   Text="Mistral API key:" VerticalOptions="Center" FontSize="14" FontAttributes="Bold" 
                   TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
            <Entry Grid.Row="1" Grid.Column="1" 
                   x:Name="ApiKeyEntry" Placeholder="Your Mistral API Key" />

            <Label Grid.Row="2" Grid.Column="0" 
                   Text="Proxy (Optional):" VerticalOptions="Center" FontSize="14" FontAttributes="Bold" 
                   TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
            <Entry Grid.Row="2" Grid.Column="1" 
                   x:Name="ProxyEntry" Placeholder="user:pass@ip:port" ClearButtonVisibility="WhileEditing" />

            <Label Grid.Row="3" Grid.Column="0" 
                   Text="Operation Mode:" VerticalOptions="Center" FontSize="14" FontAttributes="Bold" 
                   TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />

            <Grid Grid.Row="3" Grid.Column="1" ColumnDefinitions="Auto, Auto, Auto" ColumnSpacing="5" VerticalOptions="Center">
                <Label Grid.Column="0" Text="Dictate" VerticalOptions="Center" TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"/>
                <Switch Grid.Column="1" x:Name="ModeSwitch" Toggled="OnModeToggled"/>
                <Label Grid.Column="2" Text="Command" VerticalOptions="Center" TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"/>
            </Grid>

            <VerticalStackLayout Grid.Row="4" Grid.ColumnSpan="2" 
                                 x:Name="SystemPromptContainer" IsVisible="False" Spacing="5">
                <Label Text="System Prompt:" FontSize="14" FontAttributes="Bold" 
                       TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
                <Border Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                        StrokeThickness="1"
                        StrokeShape="RoundRectangle 8"
                        Padding="0">
                    <Editor x:Name="SystemPromptEditor"
                            HeightRequest="80"
                            Placeholder="Enter system prompt here..."
                            BackgroundColor="Transparent"
                            Margin="5"/>
                </Border>
            </VerticalStackLayout>

            <Button Grid.Row="5" Grid.ColumnSpan="2" 
                    x:Name="SaveBtn" Text="Save" FontAttributes="Bold" Clicked="OnSaveClicked" />

            <Label Grid.Row="6" Grid.ColumnSpan="2" 
                   x:Name="StatusLabel" HorizontalOptions="Center" TextColor="Green" HeightRequest="20"/>

        </Grid>

        <BoxView Grid.Row="0" VerticalOptions="End" HeightRequest="1" Color="{StaticResource Gray300}" Margin="20,0"/>

        <Grid Grid.Row="1" RowDefinitions="Auto, *" Padding="20, 10, 20, 20">
            <Label Grid.Row="0" Text="Log" Style="{StaticResource Headline}" FontSize="28" Margin="0,0,0,10"/>

            <Border Grid.Row="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 10"
                    Padding="5"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Black}}">

                <RefreshView x:Name="LogsRefreshView" Refreshing="OnLogsRefreshing">
                    <CollectionView x:Name="LogsCollectionView">
                        <CollectionView.EmptyView>
                            <Label Text="Нет записей" HorizontalOptions="Center" VerticalOptions="Center" TextColor="Gray"/>
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding .}" FontSize="12" TextColor="{AppThemeBinding Light=Black, Dark=White}" Padding="5,2"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </RefreshView>

            </Border>
        </Grid>

    </Grid>

</ContentPage>