<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WhisperInk.Maui.MainPage"
             Title="WhisperInk Dashboard">

    <Grid RowDefinitions="55*, 45*">

        <ScrollView Grid.Row="0" VerticalScrollBarVisibility="Always">
            <VerticalStackLayout Padding="20" Spacing="15">

                <Label Text="Settings" Style="{StaticResource Headline}" FontSize="28" Margin="0,0,0,5" />

                <Label Text="Mistral API key" FontSize="14" FontAttributes="Bold" TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
                <Entry x:Name="ApiKeyEntry" Placeholder="Your Mistral API Key" />

                <Label Text="Proxy (Optional)" FontSize="14" FontAttributes="Bold" TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
                <Entry x:Name="ProxyEntry" Placeholder="user:pass@ip:port" ClearButtonVisibility="WhileEditing" />
                <Label Text="Format: user:password@host:port" FontSize="11" Margin="0,-10,0,0" TextColor="{AppThemeBinding Light={StaticResource Gray500}, Dark={StaticResource White}}" />

                <Label Text="Operation Mode" FontSize="14" FontAttributes="Bold" Margin="0,5,0,0" TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />
                <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                    <Label Text="Dictation" VerticalOptions="Center" TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"/>
                    <Switch x:Name="ModeSwitch" Toggled="OnModeToggled"/>
                    <Label Text="Command Mode (AI)" VerticalOptions="Center" TextColor="{AppThemeBinding Light={StaticResource Gray900}, Dark={StaticResource White}}"/>
                </HorizontalStackLayout>

                <VerticalStackLayout x:Name="SystemPromptContainer" IsVisible="False" Spacing="5">
                    <Label Text="System Prompt" FontSize="14" FontAttributes="Bold" Margin="0,5,0,0" TextColor="{AppThemeBinding Light={StaticResource MidnightBlue}, Dark={StaticResource White}}" />

                    <Border Stroke="{AppThemeBinding Light={StaticResource Gray300}, Dark={StaticResource Gray600}}"
                            StrokeThickness="1"
                            StrokeShape="RoundRectangle 8"
                            Padding="0">
                        <Editor x:Name="SystemPromptEditor"
                                HeightRequest="100"
                                Placeholder="Enter system prompt here..."
                                BackgroundColor="Transparent"
                                Margin="5"/>
                    </Border>
                </VerticalStackLayout>

                <Button x:Name="SaveBtn" Text="Save" FontAttributes="Bold" Clicked="OnSaveClicked" HorizontalOptions="Fill" Margin="0,10,0,0"/>

                <Label x:Name="StatusLabel" HorizontalOptions="Center" TextColor="Green" HeightRequest="20"/>
                <BoxView HeightRequest="1" Color="{StaticResource Gray300}" Margin="0,5"/>

            </VerticalStackLayout>
        </ScrollView>

        <Grid Grid.Row="1" RowDefinitions="Auto, *" Padding="20, 0, 20, 20">

            <Label Text="Log"
                   Style="{StaticResource Headline}"
                   FontSize="28"
                   Margin="0,0,0,10"/>

            <Border Grid.Row="1"
                    Stroke="{AppThemeBinding Light={StaticResource Gray400}, Dark={StaticResource Gray500}}"
                    StrokeThickness="1"
                    StrokeShape="RoundRectangle 10"
                    Padding="5"
                    BackgroundColor="{AppThemeBinding Light={StaticResource Gray100}, Dark={StaticResource Black}}">

                <RefreshView x:Name="LogsRefreshView" Refreshing="OnLogsRefreshing">
                    <CollectionView x:Name="LogsCollectionView">
                        <CollectionView.EmptyView>
                            <Label Text="Нет записей" HorizontalOptions="Center" VerticalOptions="Center" TextColor="Gray"/>
                        </CollectionView.EmptyView>
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding .}" FontSize="12" TextColor="{AppThemeBinding Light=Black, Dark=White}" Padding="5,2"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </RefreshView>

            </Border>
        </Grid>

    </Grid>

</ContentPage>